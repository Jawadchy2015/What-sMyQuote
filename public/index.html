<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>What's My Quote – Login / Sign Up</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: [
                'Inter',
                'ui-sans-serif',
                'system-ui',
                '-apple-system',
                'Segoe UI',
                'Roboto',
                'Ubuntu',
                'Cantarell',
                'Noto Sans',
                'Helvetica Neue',
                'Arial',
                'sans-serif',
              ],
            },
            boxShadow: {
              soft: '0 20px 50px -15px rgba(0,0,0,0.25)',
            },
          },
        },
      };
    </script>

    <!-- Font Awesome (icons) -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />

    <style>
      .btn-pill { border-radius: 9999px; }
      .fade-enter { opacity: 0; transform: translateY(6px); }
      .fade-enter-active { opacity: 1; transform: translateY(0); transition: all .25s ease; }
      .fade-exit { opacity: 1; transform: translateY(0); }
      .fade-exit-active { opacity: 0; transform: translateY(-6px); transition: all .2s ease; }
    </style>
  </head>
  <body class="min-h-screen bg-gradient-to-br from-slate-50 to-blue-100 text-slate-800 font-sans">
    <!-- Dashboard Link -->
    <a
      href="/dashboard"
      class="absolute top-4 right-4 inline-flex items-center gap-1 text-sm font-medium text-slate-600 hover:text-blue-700 transition-colors"
    >
      Go to Dashboard <span aria-hidden>→</span>
    </a>

    <!-- Wrapper -->
    <main class="min-h-screen w-full flex items-center justify-center p-4">
      <div class="w-full max-w-5xl bg-white rounded-2xl shadow-soft overflow-hidden grid grid-cols-1 md:grid-cols-2">
        <!-- Left: Brand & Switcher -->
        <section class="relative bg-gradient-to-br from-blue-600 to-blue-700 text-white p-8 flex flex-col items-center justify-center">
          <div class="absolute inset-0 opacity-10 pointer-events-none" aria-hidden>
            <div class="w-[600px] h-[600px] rounded-full bg-white blur-3xl absolute -bottom-20 -left-20"></div>
          </div>

          <div class="relative flex flex-col items-center text-center">
            <div class="w-14 h-14 rounded-2xl bg-white/10 border border-white/20 grid place-items-center">
              <i class="fas fa-bell text-2xl"></i>
            </div>
            <h1 class="mt-4 text-3xl font-semibold tracking-tight">What's My Quote</h1>
            <p class="mt-2 text-blue-100 max-w-xs">Your all‑in‑one tool for Bell and Virgin quotes.</p>

            <div class="mt-8 w-full flex items-center justify-center gap-3">
              <button id="tabLogin" class="btn-pill px-5 py-2.5 bg-white text-blue-700 font-semibold shadow hover:shadow-md transition">Login</button>
              <button id="tabSignup" class="btn-pill px-5 py-2.5 border border-white/60 text-white font-semibold hover:bg-white/10 transition">Sign Up</button>
            </div>
          </div>
        </section>

        <!-- Right: Forms -->
        <section class="relative p-8 md:p-10 overflow-hidden mx-10 my-5">
          <!-- Alert -->
          <div id="alert" class="hidden mb-4 rounded-xl border border-red-200 bg-red-50 text-red-700 px-4 py-3 text-sm" role="alert"></div>

          <!-- Login Form -->
          <form id="loginForm" class="space-y-5" autocomplete="on" novalidate>
            <h2 class="text-2xl font-semibold">Login</h2>

            <div>
              <label for="login-email" class="block text-sm font-medium text-slate-700">Email</label>
              <div class="mt-1 relative">
                <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-slate-400"><i class="far fa-envelope"></i></span>
                <input id="login-email" type="email" autocomplete="email" required class="pl-10 w-full rounded-xl border border-slate-200 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="you@example.com" />
              </div>
            </div>

            <div>
              <label for="login-password" class="block text-sm font-medium text-slate-700">Password</label>
              <div class="mt-1 relative">
                <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-slate-400"><i class="far fa-lock"></i></span>
                <input id="login-password" type="password" autocomplete="current-password" required class="pl-10 pr-10 w-full rounded-xl border border-slate-200 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="••••••••" />
                <button type="button" id="toggleLoginPw" class="absolute inset-y-0 right-0 pr-3 text-slate-400 hover:text-slate-600" aria-label="Show password"><i class="far fa-eye"></i></button>
              </div>
            </div>

            <div class="flex items-center justify-between">
              <a class="text-sm text-blue-700 hover:underline" href="#">Forgot password?</a>
              <button type="submit" id="loginBtn" class="inline-flex items-center justify-center gap-2 rounded-xl bg-blue-600 hover:bg-blue-700 text-white px-5 py-2.5 font-semibold disabled:opacity-50 disabled:cursor-not-allowed">
                <span>Login</span>
                <span id="loginSpinner" class="hidden h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin" aria-hidden></span>
              </button>
            </div>

            <div class="pt-3">
              <div class="relative text-center">
                <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-slate-200"></div></div>
                <span class="relative bg-white px-2 text-xs text-slate-500">OR LOGIN WITH</span>
              </div>
              <div class="mt-4 flex justify-center gap-6 text-slate-400">
                <a href="#" aria-label="Login with Facebook" class="hover:text-blue-600"><i class="fab fa-facebook-square fa-2x"></i></a>
                <a href="#" aria-label="Login with Google" class="hover:text-red-600"><i class="fab fa-google fa-2x"></i></a>
                <a href="#" aria-label="Login with X" class="hover:text-blue-400"><i class="fab fa-twitter fa-2x"></i></a>
              </div>
            </div>
          </form>

          <!-- Signup Form -->
          <form id="signupForm" class="space-y-5 absolute top-8 left-0 right-0 opacity-0 pointer-events-none" autocomplete="on" novalidate>
            <h2 class="text-2xl font-semibold">Create your account</h2>

            <div>
              <label for="signup-username" class="block text-sm font-medium text-slate-700">Username</label>
              <div class="mt-1 relative">
                <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-slate-400"><i class="far fa-user"></i></span>
                <input id="signup-username" type="text" autocomplete="username" required class="pl-10 w-full rounded-xl border border-slate-200 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="yourname" />
              </div>
            </div>

            <div>
              <label for="signup-email" class="block text-sm font-medium text-slate-700">Email</label>
              <div class="mt-1 relative">
                <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-slate-400"><i class="far fa-envelope"></i></span>
                <input id="signup-email" type="email" autocomplete="email" required class="pl-10 w-full rounded-xl border border-slate-200 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="you@example.com" />
              </div>
            </div>

            <div>
              <label for="signup-password" class="block text-sm font-medium text-slate-700">Create password</label>
              <div class="mt-1 relative">
                <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-slate-400"><i class="far fa-lock"></i></span>
                <input id="signup-password" type="password" autocomplete="new-password" minlength="8" required class="pl-10 pr-10 w-full rounded-xl border border-slate-200 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="At least 8 characters" />
                <button type="button" id="toggleSignupPw" class="absolute inset-y-0 right-0 pr-3 text-slate-400 hover:text-slate-600" aria-label="Show password"><i class="far fa-eye"></i></button>
              </div>
              <p class="mt-1 text-xs text-slate-500">Use at least 8 characters, including a number.</p>
            </div>

            <div class="flex items-center justify-end">
              <button type="submit" id="signupBtn" class="inline-flex items-center justify-center gap-2 rounded-xl bg-blue-600 hover:bg-blue-700 text-white px-5 py-2.5 font-semibold disabled:opacity-50 disabled:cursor-not-allowed">
                <span>Create account</span>
                <span id="signupSpinner" class="hidden h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin" aria-hidden></span>
              </button>
            </div>

            <div class="pt-3">
              <div class="relative text-center">
                <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-slate-200"></div></div>
                <span class="relative bg-white px-2 text-xs text-slate-500">OR SIGN UP WITH</span>
              </div>
              <div class="mt-4 flex justify-center gap-6 text-slate-400">
                <a href="#" aria-label="Continue with Facebook" class="hover:text-blue-600"><i class="fab fa-facebook-square fa-2x"></i></a>
                <a href="#" aria-label="Continue with Google" class="hover:text-red-600"><i class="fab fa-google fa-2x"></i></a>
                <a href="#" aria-label="Continue with X" class="hover:text-blue-400"><i class="fab fa-twitter fa-2x"></i></a>
              </div>
            </div>
          </form>

          <!-- SR-only live region for messages -->
          <p id="live" class="sr-only" aria-live="polite"></p>
        </section>
      </div>
    </main>

    <!-- Toast -->
    <div id="toast" class="hidden fixed bottom-6 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-4 py-2.5 rounded-xl shadow-soft text-sm"></div>

    <script>
      const $ = (s, r=document) => r.querySelector(s);
      const $$ = (s, r=document) => [...r.querySelectorAll(s)];
      const toast = (msg) => { const t = $('#toast'); t.textContent = msg; t.classList.remove('hidden'); setTimeout(()=> t.classList.add('hidden'), 1800); };
      const showAlert = (msg) => { const a = $('#alert'); a.textContent = msg; a.classList.remove('hidden'); };
      const hideAlert = () => { $('#alert').classList.add('hidden'); };

      // Tabs
      const tabLogin = $('#tabLogin');
      const tabSignup = $('#tabSignup');
      const loginForm = $('#loginForm');
      const signupForm = $('#signupForm');
      const live = $('#live');

      function toLogin(){
        // styles
        tabLogin.classList.add('bg-white','text-blue-700','shadow');
        tabSignup.classList.remove('bg-white','text-blue-700','shadow');
        tabSignup.classList.add('border','border-white/60','text-white');
        // forms
        signupForm.style.opacity = 0; signupForm.style.pointerEvents = 'none';
        loginForm.style.opacity = 1; loginForm.style.pointerEvents = 'auto';
        hideAlert();
        live.textContent = 'Showing login form';
      }

      function toSignup(){
        tabSignup.classList.add('bg-white','text-blue-700','shadow');
        tabLogin.classList.remove('bg-white','text-blue-700','shadow');
        tabLogin.classList.add('border','border-white/60','text-white');
        loginForm.style.opacity = 0; loginForm.style.pointerEvents = 'none';
        signupForm.style.opacity = 1; signupForm.style.pointerEvents = 'auto';
        hideAlert();
        live.textContent = 'Showing signup form';
      }

      tabLogin.addEventListener('click', toLogin);
      tabSignup.addEventListener('click', toSignup);

      // Password toggles
      function bindToggle(btnId, inputId){
        const btn = document.getElementById(btnId);
        const input = document.getElementById(inputId);
        btn.addEventListener('click', ()=>{
          const show = input.type === 'password';
          input.type = show ? 'text' : 'password';
          btn.setAttribute('aria-label', show ? 'Hide password' : 'Show password');
          btn.innerHTML = show ? '<i class="far fa-eye-slash"></i>' : '<i class="far fa-eye"></i>';
        });
      }
      bindToggle('toggleLoginPw','login-password');
      bindToggle('toggleSignupPw','signup-password');

      // Submit handlers (same endpoints you already wired)
      async function submitLogin(e){
        e.preventDefault(); hideAlert();
        const btn = $('#loginBtn'); const spinner = $('#loginSpinner');
        const email = $('#login-email').value.trim();
        const password = $('#login-password').value.trim();
        try{
          btn.disabled = true; spinner.classList.remove('hidden');
          const res = await fetch('/api/login', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email, password }) });
          const data = await res.json();
          if(!res.ok){ showAlert(data.message || 'Login failed.'); return; }
          localStorage.setItem('token', data.token);
          // toast('Welcome back!');
          // Set a flag in sessionStorage right before you redirect
          sessionStorage.setItem('showWelcomeMessage', 'true');
          window.location.href = '/dashboard';
        } catch(err){ console.error(err); showAlert('Server error during login.'); }
        finally { btn.disabled = false; spinner.classList.add('hidden'); }
      }

      async function submitSignup(e){
        e.preventDefault(); hideAlert();
        const btn = $('#signupBtn'); const spinner = $('#signupSpinner');
        const username = $('#signup-username').value.trim();
        const email = $('#signup-email').value.trim();
        const password = $('#signup-password').value.trim();
        try{
          btn.disabled = true; spinner.classList.remove('hidden');
          const res = await fetch('/api/signup', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ username, email, password }) });
          const data = await res.json();
          if(!res.ok){ showAlert(data.message || 'Signup failed.'); return; }
          toast('Signup successful! Please log in.');
          toLogin();
        } catch(err){ console.error(err); showAlert('Server error during signup.'); }
        finally { btn.disabled = false; spinner.classList.add('hidden'); }
      }

      loginForm.addEventListener('submit', submitLogin);
      signupForm.addEventListener('submit', submitSignup);

      // Default state
      toLogin();
    </script>
  </body>
</html>
